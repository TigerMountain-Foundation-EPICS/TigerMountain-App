<!DOCTYPE html>
<html>

<head>
  <title>Log</title>
  <link rel="icon" src=""> <!--replace with TMF logo-->
  <link rel="stylesheet" type="text/css" href="bootstrap\css\bootstrap.min.css">
  <style>
    body { max-width:900px; margin:18px auto; padding:12px; font-family: Arial, Helvetica, sans-serif; }
    header { display:flex; align-items:center; gap:12px; margin-bottom:8px; }
    .muted { color:#666; }
    .section { padding:10px; border:1px solid #eee; border-radius:8px; margin-top:12px; background:#fff; }
    #logList .log-item { padding:8px; border-bottom:1px dashed #eee; }
    #changelogList .changelog-item { padding:6px; border-bottom:1px solid #fafafa; font-size:0.9rem; }
    label { display:block; margin-top:8px; }
    input, select { padding:6px; width:100%; box-sizing:border-box; margin-top:4px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .small-btn { padding:6px 8px; margin-left:6px; }
  </style>
</head>

<header>
  <h1>Log Page - Aamuktha</h1>
</header>

<main>

  <body>
    <hr>

    <!-- LOG BUTTONS -->
    <h2>Quick Log</h2>
    <div class="row">
      <button id="quickTemp" class="btn btn-primary">Log Temperature</button>
      <button id="quickPh" class="btn btn-primary">Log pH</button>
      <button id="quickMoist" class="btn btn-primary">Log Moisture</button>
    </div>

    <hr>

    <!-- LOG SUBPAGE -->
    <h2>Log Subpage</h2>

    <label>Garden Bed:</label>
    <select id="gardenBed">
      <option value="Bed 1">Bed 1</option>
      <option value="Bed 2">Bed 2</option>
      <option value="Bed 3">Bed 3</option>
    </select>

    <p>
      <strong>Sensor Status:</strong>
      <span id="sensorStatus">Connected</span>
      <button id="simulateSensor" class="btn btn-sm btn-outline-secondary small-btn">Simulate Sensor</button>
    </p>

    <label>Log Type:</label>
    <select id="logType">
      <option value="temperature">Temperature</option>
      <option value="pH">pH</option>
      <option value="moisture">Moisture</option>
    </select>

    <label>Value:</label>
    <input type="number" id="logValue" placeholder="Numeric value">

    <br><br>
    <button id="submitLog" class="btn btn-success">Submit Log</button>

    <hr>

    <!-- RECENT LOGS -->
    <h2>Recent Logs</h2>
    <div id="logList" class="section" aria-live="polite">
      <!-- logs appear here -->
    </div>

    <!-- CHANGES / ACTIVITY -->
    <section class="section" style="margin-top:12px">
      <h3>Changelog</h3>
      <div id="changelogList" class="muted">No changes recorded yet.</div>
    </section>

    <hr>

    <footer>
      <p>Footer Section</p>
    </footer>
  </body>
</main>

<script>
  const STORAGE_KEY = 'simple_logs_v1';
  const CURRENT_USER = 'Aamuktha'; // change if needed

  // DOM refs
  const quickTemp = document.getElementById('quickTemp');
  const quickPh = document.getElementById('quickPh');
  const quickMoist = document.getElementById('quickMoist');
  const submitLogBtn = document.getElementById('submitLog');
  const simulateSensorBtn = document.getElementById('simulateSensor');

  const gardenBedEl = document.getElementById('gardenBed');
  const logTypeEl = document.getElementById('logType');
  const logValueEl = document.getElementById('logValue');

  const logListEl = document.getElementById('logList');
  const changelogEl = document.getElementById('changelogList');
  const sensorStatusEl = document.getElementById('sensorStatus');

  // helper functions
  function nowISO(){ return new Date().toISOString(); }
  function human(iso){ return new Date(iso).toLocaleString(); }

  function loadLogs(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch(e){ return []; } }
  function saveLogs(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

  // very small changelog helper
  function addChangelog(msg){
    const time = human(nowISO());
    const el = document.createElement('div');
    el.className = 'changelog-item';
    el.textContent = `${time} — ${msg}`;
    if (changelogEl.textContent.trim() === 'No changes recorded yet.') changelogEl.innerHTML = '';
    changelogEl.prepend(el);
  }

  // render logs (simple)
  function renderLogs(){
    const logs = loadLogs().slice().sort((a,b) => new Date(b.t) - new Date(a.t));
    if (!logs.length) {
      logListEl.innerHTML = '<div class="muted">No logs yet.</div>';
      return;
    }
    logListEl.innerHTML = logs.map(l => {
      const unit = l.type.includes('temp') ? ' °C' : (l.type.includes('moist') ? ' %' : '');
      return `<div class="log-item">
                <strong>${escapeHtml(l.type)}</strong> — ${escapeHtml(String(l.value))}${unit}
                <div class="muted">${escapeHtml(l.bed)} • ${escapeHtml(l.user)} • ${human(l.t)}</div>
              </div>`;
    }).join('');
  }

  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

  // add a log (minimal validation)
  function addLog(type, value){
    if (value === '' || value === null || isNaN(Number(value))) { alert('Please enter a numeric value'); return; }
    const logs = loadLogs();
    logs.push({
      id: 'L' + Math.random().toString(36).slice(2,9),
      t: nowISO(),
      user: CURRENT_USER,
      bed: gardenBedEl.value,
      type,
      value: Number(value)
    });
    saveLogs(logs);
    renderLogs();
    addChangelog(`Added ${type} log (${value}) to ${gardenBedEl.value}`);
  }

  // sensor simulate (simple toggle)
  let sensorOnline = true;
  function toggleSensor(){
    sensorOnline = !sensorOnline;
    sensorStatusEl.textContent = sensorOnline ? 'Connected' : 'Disconnected';
    addChangelog('Sensor ' + (sensorOnline ? 'connected' : 'disconnected'));
  }

  // wire events
  quickTemp.addEventListener('click', ()=> {
    const v = prompt('Enter temperature (°C):', '21');
    if (v !== null) addLog('temperature', v);
  });

  quickPh.addEventListener('click', ()=> {
    const v = prompt('Enter pH (e.g. 6.5):', '6.8');
    if (v !== null) addLog('pH', v);
  });

  quickMoist.addEventListener('click', ()=> {
    const v = prompt('Enter moisture % (e.g. 45):', '48');
    if (v !== null) addLog('moisture', v);
  });

  submitLogBtn.addEventListener('click', ()=> {
    const type = logTypeEl.value;
    const v = logValueEl.value;
    if (v === '' || isNaN(Number(v))) { alert('Please enter a numeric value'); return; }
    addLog(type, v);
    logValueEl.value = '';
  });

  simulateSensorBtn.addEventListener('click', toggleSensor);

  // initialize
  renderLogs();
</script>

<script src="bootstrap\js\bootstrap.bundle.min.js"></script>
</html>
